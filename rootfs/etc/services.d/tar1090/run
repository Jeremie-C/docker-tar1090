#!/usr/bin/with-contenv bash
# shellcheck shell=bash

mkdir -p /run/tar1090
sleep 5

srcdir=/run/readsb
service=readsb

export INTERVAL="${TAR_INVERVAL}"
export HISTORY_SIZE="${TAR_HISTORY_SIZE:-450}"
export CHUNK_SIZE="${TAR_CHUNK_SIZE:-60}"

/usr/local/share/tar1090/tar1090.sh \
  "/run/$service" \
  "$srcdir" \
  2>&1 | mawk -W interactive '{print "[tar1090] " $0}'
